<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<style>
     body{
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            font-size: 15px;
            font-weight: bold;
            background-color: #e0e0ee;
        }
    input{
        width: 200px;

    }
    #movies{
        height: 100px;
        width: 306px;
        border: 1px solid black;
        overflow: scroll;
        display: none;
    }
    .main-cont{
           display: flex;
           margin: auto;
           justify-content: center;
       }
       .main-cont>div{
           margin: 12px;
       }
       img{
           border: 2px solid black;
           border-radius: 5px;
       }
       div>p{
           font-size: 18px;
           color: black;    
       }
</style>
<body>
  
  <input type="text" id="movie" oninput="debounce(searchMovie,500)" placeholder="Movie"/>
 <!-- <button onclick="display">Search</button> -->
  
 <div id="movies">

  </div>


<div class="main-cont">

</div>
</body>
</html>
<script>
   let movies_div = document.getElementById("movies");
   let resultGrid = document.getElementsByClassName("resultGrid");
   var searchBox = document.querySelector("#movies");

    let movie_waiting;
   
    async function searchMovie(){
        try{
            
            let movie = document.getElementById("movie").value;
            searchBox.style.display="block";
                // this is for if ab this type of word then return nothing
            if(movie.length <2){
                return false;
            }
          //  https://www.omdbapi.com/?s=${name}&apikey=d806bd70
          
               let url = (`http://www.omdbapi.com/?apikey=e00f0217&s=${movie}`);
                // let url = (`https://www.omdbapi.com/?s=${movie}&apikey=d806bd70`);


                let response = await fetch(url);
                let data = await response.json();
                let movies_arr = data.Search;
                console.log(movies_arr);
                appendMovies(movies_arr);
        }catch(err){
            console.log("Error:",err);
        }
    }
    function appendMovies(movies){
        movies_div.innerHTML=null;
        if(movies==undefined){
            return false;
        }
        movies.forEach(function (element){
            let p = document.createElement("p");
            p.innerText=element.Title;
            let dp = document.createElement("img");
            dp.src=element.Poster;
            movies_div.append(p,dp);
            //this is for display in list
            
            p.addEventListener("click",function(event){
                    displayMovie(event);
            });
           

        });
    }




    function debounce(func,delay){
        if(movie_waiting){
            clearTimeout(movie_waiting);

        }
        movie_waiting = setTimeout(function(){
            func();
        },delay);
    }
    

function displayMovie(event){
    searchBox.style.display="none";

    var search=event.target.innerText;
    
    let siteData = "https://www.omdbapi.com/?t=";
    let key="&apikey=e00f0217"
    // let url = "http://www.omdbapi.com/?i=tt3896198&apikey=e00f0217&";


        let movieUrl=siteData+search+key;
        
        
        fetch(movieUrl).then(function(res){
            return res.json();
        })
        .then(function(res){
            console.log("res",res);
            displayMovie(res);
        })
        .catch(function(er){
            console.log("error:",er);
        })
    
 


    function displayMovie(movie){
    document.querySelector(".main-cont").innerHTML="";

        if(movie.Title===undefined){
            var div=document.createElement("div")
        div.id="container"
        var img=document.createElement("img")
        div.append(img)
        img.src="https://media2.giphy.com/media/UoeaPqYrimha6rdTFV/giphy.gif"

        document.querySelector(".main-cont").append(div)

        }else if(movie.Poster=="N/A"){
            var div=document.createElement("div")
        div.id="container"
        var img=document.createElement("img")
        div.append(img)
        img.src="https://media2.giphy.com/media/UoeaPqYrimha6rdTFV/giphy.gif"

        document.querySelector(".main-cont").append(div)


        }
        else{
            let div= document.createElement("div");
            div.setAttribute("id","movieCont");
            
            let img = document.createElement("img");
            img.src=movie.Poster;

            let name = document.createElement("h2");
            name.textContent=(`${movie.Title}`);

            let year = document.createElement("p");
            year.textContent=(`Year- ${movie.Year}`);

            
            let rating = document.createElement("p");
            // rating.textContent(`Rating- ${movie.imdbRating}`);
                if(movie.imdbRating>8.5){
                    rating.textContent="(Recommended)"+" "+ (`IMDB rating-${movie.imdbRating}`);
                    rating.style.color="red";   
                }else{
                    rating.textContent=(`IMDB rating-${movie.imdbRating}`);

                }

            let released = document.createElement("p");
            released.textContent=(`Released - ${movie.Released}`)

            let runtime = document.createElement("p");
            runtime.textContent=(`Runtime - ${movie.Runtime}`);

            let writter = document.createElement("p");
            writter.textContent=(`Writter - ${movie.Writer}`);

            let language = document.createElement("p");
            language.textContent=(`Language - ${movie.Language}`);

                div.append(img);
                var info = document.createElement("div");
                info.append(name,year,rating,released,
                runtime,writter,language);
               
                document.querySelector(".main-cont").append(div,info);

            
        }
    }

   
}



</script>